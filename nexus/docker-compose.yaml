version: '3.3'

services:
  traefik:
    image: traefik:v2.3
    ports:
      - "80:80"
      - "443:443"
      - "8080:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./letsencrypt:/letsencrypt
      - ./traefik.yaml:/etc/traefik/traefik.yaml
    deploy:
      placement:
        constraints: [node.role==manager]
        
  nexus:
    image: sonatype/nexus3
    volumes:
      - ${VOL_BASE_DIR}/nexus:/nexus-data
    labels:
      - "traefik.enable=true"
    # Routers
      - "traefik.http.routers.nexus.rule=Host(`your_domain_here`)"
      - "traefik.http.routers.nexus.service=nexus"
      - "traefik.http.routers.nexus.entrypoints=websecure"
      - "traefik.http.routers.nexus.tls.certresolver=myresolver"
      #- "traefik.http.routers.catapp.middlewares=test-compress"
    # Services
      - "traefik.http.services.nexus.loadbalancer.server.port=8081"
    # Middleware
      #- "traefik.http.middlewares.test-compress.compress=true"    

  portainer:
    image: portainer/portainer:latest
    command: -H unix:///var/run/docker.sock
    ports:
      - 9000:9000
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    deploy:
      placement:
        constraints: [node.role==manager]
        
volumes:
  nexus-volume:
